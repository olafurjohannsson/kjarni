use kjarni_models::SentenceEncoder;
use kjarni_transformers::models::ModelType;
use kjarni_transformers::traits::Device;
use kjarni_transformers::WgpuContext;
use std::sync::Arc;



#[tokio::main]
async fn main() -> anyhow::Result<()> {
    // 1. Setup
    let ctx = WgpuContext::new().await?;
    
    println!("Loading CPU Model...");
    let cpu_encoder = SentenceEncoder::from_registry(
        ModelType::MiniLML6V2,
        None,
        Device::Cpu,
        None,
        None,
    ).await?;

    println!("Loading GPU Model...");
    let gpu_encoder = SentenceEncoder::from_registry(
        ModelType::MiniLML6V2,
        None,
        Device::Wgpu,
        Some(ctx),
        None,
    ).await?;

    let sentences = [
        "The cat sits on the mat", // Index 0 (Checked against Golden)
        "A feline rests on a rug",
        "Dogs are playing in the park",
    ];

    println!("\n=== TEST 1: Default Encode (Mean + Norm) ===");
    let cpu_res = cpu_encoder.encode_batch(&sentences).await?;
    let gpu_res = gpu_encoder.encode_batch(&sentences).await?;
    
    verify("CPU Mean+Norm", &cpu_res[0], GOLDEN_MEAN_NORM);
    verify("GPU Mean+Norm", &gpu_res[0], GOLDEN_MEAN_NORM);
    compare_cpu_gpu("Mean+Norm", &cpu_res[0], &gpu_res[0]);

    println!("\n=== TEST 2: Encode Raw (Mean + No Norm) ===");
    let cpu_res = cpu_encoder.encode_batch_raw(&sentences).await?;
    // Note: encode_batch_raw uses internal encode with normalize=false
    let gpu_res = gpu_encoder.encode_batch_raw(&sentences).await?;

    verify("CPU Mean Raw", &cpu_res[0], GOLDEN_MEAN_RAW);
    verify("GPU Mean Raw", &gpu_res[0], GOLDEN_MEAN_RAW);
    compare_cpu_gpu("Mean Raw", &cpu_res[0], &gpu_res[0]);

    println!("\n=== TEST 3: Pooling Strategy: CLS ===");
    let cpu_res = cpu_encoder.encode_with(sentences[0], Some("cls"), true).await?;
    let gpu_res = gpu_encoder.encode_with(sentences[0], Some("cls"), true).await?;

    verify("CPU CLS", &cpu_res, GOLDEN_CLS_NORM);
    verify("GPU CLS", &gpu_res, GOLDEN_CLS_NORM);
    compare_cpu_gpu("CLS", &cpu_res, &gpu_res);

    println!("\n=== TEST 4: Pooling Strategy: MAX ===");
    let cpu_res = cpu_encoder.encode_with(sentences[0], Some("max"), true).await?;
    let gpu_res = gpu_encoder.encode_with(sentences[0], Some("max"), true).await?;

    verify("CPU Max", &cpu_res, GOLDEN_MAX_NORM);
    verify("GPU Max", &gpu_res, GOLDEN_MAX_NORM);
    compare_cpu_gpu("Max", &cpu_res, &gpu_res);

    println!("\n=== TEST 5: Pooling Strategy: LastToken ===");
    let cpu_res = cpu_encoder.encode_with(sentences[0], Some("lastToken"), true).await?;
    let gpu_res = gpu_encoder.encode_with(sentences[0], Some("lastToken"), true).await?;

    verify("CPU LastToken", &cpu_res, GOLDEN_LAST_NORM);
    verify("GPU LastToken", &gpu_res, GOLDEN_LAST_NORM);
    compare_cpu_gpu("LastToken", &cpu_res, &gpu_res);

    println!("\n✅ All verifications passed successfully!");
    Ok(())
}

fn verify(label: &str, actual: &[f32], expected: &[f32]) {
    // 1. Cosine Similarity (Should be ~1.0)
    let sim = cosine_similarity(actual, expected);
    
    // 2. Max Absolute Difference (Strict numerical check)
    // F32 precision usually allows error around 1e-5 to 1e-6
    let max_diff = actual.iter().zip(expected.iter())
        .map(|(a, b)| (a - b).abs())
        .fold(0.0, f32::max);

    println!("{:<15} | Cosine: {:.6} | Max Diff: {:.6}", label, sim, max_diff);

    if sim < 0.999 {
        eprintln!("⚠️ WARNING: {} similarity is low!", label);
    }
    if max_diff > 1e-4 {
        eprintln!("⚠️ WARNING: {} numerical drift detected!", label);
    }
}

fn compare_cpu_gpu(label: &str, cpu: &[f32], gpu: &[f32]) {
    let sim = cosine_similarity(cpu, gpu);
    let max_diff = cpu.iter().zip(gpu.iter())
        .map(|(a, b)| (a - b).abs())
        .fold(0.0, f32::max);
    
    println!("{:<15} | CPU vs GPU Sim: {:.6} | Max Diff: {:.6}", label, sim, max_diff);
}

fn cosine_similarity(a: &[f32], b: &[f32]) -> f32 {
    let dot: f32 = a.iter().zip(b.iter()).map(|(x, y)| x * y).sum();
    let norm_a: f32 = a.iter().map(|x| x * x).sum::<f32>().sqrt();
    let norm_b: f32 = b.iter().map(|x| x * x).sum::<f32>().sqrt();
    
    if norm_a == 0.0 || norm_b == 0.0 {
        return 0.0;
    }
    
    dot / (norm_a * norm_b)
}

// ============================================================================
//  PASTE PYTHON OUTPUT HERE
// ============================================================================
// Placeholder values - REPLACE THESE with the output from python script!
// MEAN_NORM (First sentence)
const GOLDEN_MEAN_NORM: &[f32] = &[
    0.13489075,
    -0.03206336,
    -0.02033524,
    0.03590099,
    -0.02833307,
    0.04150210,
    0.03315873,
    0.03660569,
    0.00861662,
    0.03763955,
    -0.02959416,
    0.06162958,
    0.03351872,
    0.02614212,
    -0.02218409,
    -0.04269115,
    -0.07453872,
    -0.02255134,
    0.09239762,
    0.03822728,
    -0.03432012,
    -0.01081895,
    0.02459388,
    -0.07658061,
    -0.05345362,
    0.07451010,
    -0.04008892,
    -0.01992119,
    0.03299583,
    -0.01604269,
    -0.05317528,
    -0.00846049,
    0.01445671,
    0.04079418,
    0.01896822,
    -0.08802751,
    -0.00173719,
    -0.06008406,
    0.03245723,
    0.02282536,
    0.05609791,
    0.02806935,
    0.00062557,
    -0.07134502,
    0.01620764,
    -0.00853967,
    0.10221679,
    -0.12004831,
    0.05766615,
    0.00736919,
    -0.09643954,
    0.07090418,
    0.03700817,
    0.03565216,
    -0.10993437,
    -0.06260411,
    0.06954821,
    -0.05550644,
    -0.00363107,
    -0.06090513,
    -0.01551076,
    0.02838031,
    0.08536237,
    0.06964540,
    0.03530387,
    -0.05631811,
    -0.07150891,
    -0.00385855,
    -0.00288508,
    0.05856515,
    -0.03161207,
    0.02737892,
    0.01840869,
    -0.01210304,
    -0.03649442,
    -0.02597481,
    0.15664577,
    0.01034130,
    0.07720978,
    0.03612630,
    0.00282683,
    0.07105672,
    0.08671801,
    0.04073432,
    -0.01847296,
    0.05893548,
    0.03120587,
    0.04264454,
    -0.02169514,
    -0.06152786,
    0.07103240,
    0.03961624,
    -0.02721800,
    0.07482415,
    -0.05074833,
    -0.05029627,
    -0.02482031,
    0.06905080,
    0.00216149,
    0.03190232,
    -0.02391542,
    0.02029450,
    -0.02040585,
    0.09864336,
    -0.05572449,
    0.02798263,
    0.03079442,
    -0.00757424,
    0.00243455,
    -0.02257631,
    -0.02712670,
    -0.00961599,
    -0.10020853,
    0.06671590,
    0.00136805,
    0.05758929,
    0.03392885,
    -0.07676604,
    0.03021588,
    -0.04529504,
    0.04600764,
    -0.11322295,
    0.01228031,
    0.02420050,
    -0.06399105,
    -0.03239963,
    -0.07794445,
    -0.00000000,
    -0.07473622,
    -0.02038606,
    -0.03351782,
    -0.10164007,
    0.06446889,
    -0.03159624,
    -0.00527261,
    0.00961353,
    -0.06173763,
    0.01012660,
    -0.01273331,
    0.00009976,
    0.02776977,
    -0.02196676,
    -0.05244808,
    -0.05788165,
    0.01640202,
    -0.03424669,
    -0.04211717,
    -0.00867471,
    0.08771100,
    0.01364928,
    0.01127292,
    -0.00055618,
    0.00631316,
    -0.05314525,
    0.04521920,
    -0.04201124,
    -0.02440598,
    -0.00992338,
    0.00110342,
    -0.02460347,
    0.02195662,
    0.03065671,
    -0.04077914,
    -0.03226011,
    -0.04320927,
    0.05967557,
    -0.00998162,
    0.02525318,
    0.05909665,
    0.00348880,
    0.09302054,
    0.07037115,
    -0.00149362,
    0.01105945,
    -0.03106732,
    0.05418266,
    0.03434752,
    0.03694233,
    0.08053164,
    -0.02647421,
    0.02117456,
    -0.10055409,
    -0.04451719,
    -0.06049679,
    -0.05152900,
    -0.11563993,
    -0.01776283,
    0.07174451,
    -0.00384644,
    -0.14969972,
    0.04897565,
    -0.02754961,
    0.03458397,
    -0.06985904,
    0.07388503,
    -0.09063066,
    0.06833022,
    0.05772167,
    -0.05851148,
    0.09429099,
    -0.00810547,
    -0.06397607,
    -0.01346336,
    -0.06769232,
    -0.01849281,
    -0.01258138,
    -0.06670415,
    0.01548497,
    0.04989710,
    0.00629443,
    0.02729694,
    0.04063756,
    -0.03732444,
    0.00869545,
    -0.04243916,
    0.06658957,
    -0.06022865,
    0.04908560,
    0.04678279,
    0.05079217,
    0.02084408,
    -0.06879922,
    0.04097625,
    0.00000000,
    -0.06828762,
    -0.04835688,
    -0.04753593,
    -0.02071913,
    -0.08164056,
    0.02595998,
    0.08568699,
    0.04922871,
    -0.05117672,
    0.06410998,
    0.03723254,
    0.09253066,
    0.06233639,
    0.04437441,
    0.01249991,
    0.02105798,
    -0.09588887,
    -0.04769218,
    0.03931453,
    -0.04655808,
    -0.04069373,
    0.05019511,
    0.00086791,
    0.01741109,
    -0.00288013,
    0.05744327,
    0.02312263,
    -0.00096109,
    0.00275131,
    -0.11039128,
    -0.03096602,
    -0.02801142,
    -0.03031631,
    0.01660021,
    0.04637174,
    0.03271827,
    -0.09405377,
    -0.05558883,
    -0.05595959,
    -0.02271594,
    0.00399186,
    0.01864379,
    -0.05576277,
    -0.05464106,
    -0.03629543,
    0.01415398,
    -0.03359228,
    0.05768969,
    0.04646624,
    0.03462957,
    -0.00110065,
    -0.04349946,
    0.06281804,
    0.06616621,
    0.06862083,
    0.12660296,
    -0.03912033,
    -0.00617576,
    -0.04038322,
    0.10146170,
    0.04508641,
    0.02622410,
    0.09623557,
    -0.02439150,
    -0.02708687,
    -0.06418052,
    -0.02340190,
    -0.06789424,
    -0.00108593,
    -0.00098657,
    -0.00570105,
    0.10039532,
    -0.01737794,
    -0.00626756,
    0.03804042,
    0.04632756,
    0.07934125,
    0.02534474,
    -0.03627212,
    -0.05174032,
    -0.01961648,
    -0.00071926,
    -0.00717529,
    -0.02135801,
    0.00994448,
    -0.01122797,
    -0.00903426,
    0.00803439,
    -0.03649154,
    -0.03353529,
    0.06597581,
    -0.07192652,
    0.02414537,
    -0.02843088,
    -0.05076791,
    -0.00000001,
    -0.10508369,
    -0.03094557,
    -0.06449651,
    -0.02634575,
    -0.00807588,
    0.01387898,
    -0.01978862,
    -0.17918514,
    0.02313476,
    0.02419814,
    0.02415389,
    -0.05515772,
    0.01770639,
    -0.03296670,
    0.01396959,
    0.07484011,
    -0.10366338,
    -0.00506045,
    0.03764668,
    0.03551241,
    -0.03916494,
    0.01770886,
    -0.09443808,
    0.03478679,
    0.02675597,
    -0.02133134,
    -0.04231957,
    0.04305588,
    0.03798978,
    -0.02929971,
    0.03802154,
    -0.05274514,
    0.04000286,
    -0.05580445,
    -0.01955289,
    -0.03035324,
    0.03125826,
    -0.09244690,
    0.07403404,
    -0.01284875,
    0.10553663,
    0.01692612,
    0.07048541,
    -0.02117488,
    -0.04663170,
    0.05684751,
    0.02605809,
    -0.03373955,
    0.05673789,
    0.05393963,
    -0.01056070,
    0.02652657,
    -0.01030826,
    -0.00114247,
    -0.08110051,
    -0.04863556,
    0.01041566,
    0.00716844,
    0.03275091,
    0.05027725,
    0.00980357,
    0.04674226,
    0.01492453,
    0.05863349,
];

// MEAN_RAW (First sentence)
const GOLDEN_MEAN_RAW: &[f32] = &[
    0.85467082,
    -0.20315415,
    -0.12884453,
    0.22746947,
    -0.17951898,
    0.26295820,
    0.21009448,
    0.23193446,
    0.05459510,
    0.23848502,
    -0.18750925,
    0.39048642,
    0.21237539,
    0.16563706,
    -0.14055891,
    -0.27049208,
    -0.47227898,
    -0.14288579,
    0.58543336,
    0.24220887,
    -0.21745303,
    -0.06854913,
    0.15582736,
    -0.48521647,
    -0.33868334,
    0.47209764,
    -0.25400430,
    -0.12622111,
    0.20906234,
    -0.10164681,
    -0.33691978,
    -0.05360586,
    0.09159803,
    0.25847280,
    0.12018307,
    -0.55774432,
    -0.01100690,
    -0.38069391,
    0.20564973,
    0.14462200,
    0.35543764,
    0.17784801,
    0.00396365,
    -0.45204362,
    0.10269200,
    -0.05410757,
    0.64764786,
    -0.76062876,
    0.36537403,
    0.04669137,
    -0.61104310,
    0.44925049,
    0.23448461,
    0.22589289,
    -0.69654661,
    -0.39666101,
    0.44065902,
    -0.35169002,
    -0.02300657,
    -0.38589627,
    -0.09827656,
    0.17981830,
    0.54085785,
    0.44127479,
    0.22368611,
    -0.35683280,
    -0.45308203,
    -0.02444787,
    -0.01827992,
    0.37107012,
    -0.20029481,
    0.17347343,
    0.11663786,
    -0.07668515,
    -0.23122948,
    -0.16457701,
    0.99251115,
    0.06552272,
    0.48920289,
    0.22889705,
    0.01791084,
    0.45021701,
    0.54944724,
    0.25809354,
    -0.11704510,
    0.37341654,
    0.19772106,
    0.27019677,
    -0.13746090,
    -0.38984191,
    0.45006287,
    0.25100940,
    -0.17245387,
    0.47408751,
    -0.32154253,
    -0.31867829,
    -0.15726204,
    0.43750739,
    0.01369523,
    0.20213383,
    -0.15152866,
    0.12858638,
    -0.12929194,
    0.62500650,
    -0.35307160,
    0.17729856,
    0.19511417,
    -0.04799057,
    0.01542533,
    -0.14304401,
    -0.17187536,
    -0.06092716,
    -0.63492346,
    0.42271343,
    0.00866801,
    0.36488700,
    0.21497394,
    -0.48639137,
    0.19144849,
    -0.28699040,
    0.29150546,
    -0.71738315,
    0.07780833,
    0.15333490,
    -0.40544873,
    -0.20528479,
    -0.49385780,
    -0.00000000,
    -0.47353038,
    -0.12916651,
    -0.21236962,
    -0.64399374,
    0.40847635,
    -0.20019448,
    -0.03340735,
    0.06091156,
    -0.39117101,
    0.06416234,
    -0.08067855,
    0.00063208,
    0.17594989,
    -0.13918185,
    -0.33231223,
    -0.36673942,
    0.10392359,
    -0.21698780,
    -0.26685533,
    -0.05496315,
    0.55573887,
    0.08648214,
    0.07142545,
    -0.00352397,
    0.04000035,
    -0.33672950,
    0.28650984,
    -0.26618418,
    -0.15463683,
    -0.06287478,
    0.00699127,
    -0.15588814,
    0.13911766,
    0.19424160,
    -0.25837755,
    -0.20440078,
    -0.27377489,
    0.37810573,
    -0.06324377,
    0.16000471,
    0.37443772,
    0.02210510,
    0.58938020,
    0.44587317,
    -0.00946358,
    0.07007293,
    -0.19684324,
    0.34330255,
    0.21762666,
    0.23406745,
    0.51025027,
    -0.16774118,
    0.13416250,
    -0.63711298,
    -0.28206187,
    -0.38330904,
    -0.32648891,
    -0.73269713,
    -0.11254567,
    0.45457479,
    -0.02437116,
    -0.94850075,
    0.31031078,
    -0.17455493,
    0.21912479,
    -0.44262847,
    0.46813720,
    -0.57423788,
    0.43294179,
    0.36572582,
    -0.37073007,
    0.59742981,
    -0.05135642,
    -0.40535381,
    -0.08530413,
    -0.42890009,
    -0.11717088,
    -0.07971589,
    -0.42263895,
    0.09811310,
    0.31614912,
    0.03988164,
    0.17295404,
    0.25748050,
    -0.23648848,
    0.05509459,
    -0.26889548,
    0.42191303,
    -0.38161010,
    0.31100744,
    0.29641682,
    0.32182035,
    0.13206854,
    -0.43591338,
    0.25962642,
    0.00000000,
    -0.43267187,
    -0.30639026,
    -0.30118871,
    -0.13127686,
    -0.51727641,
    0.16448303,
    0.54291469,
    0.31191418,
    -0.32425684,
    0.40620229,
    0.23590624,
    0.58627635,
    0.39496472,
    0.28115726,
    0.07919974,
    0.13342381,
    -0.60755402,
    -0.30217871,
    0.24909776,
    -0.29499304,
    -0.25783640,
    0.31803736,
    0.00549909,
    0.11031708,
    -0.01824858,
    0.36396185,
    0.14650552,
    -0.00608951,
    0.01743233,
    -0.69944161,
    -0.19620137,
    -0.17748100,
    -0.19208483,
    0.10517930,
    0.29381239,
    0.20730367,
    -0.59592676,
    -0.35221207,
    -0.35456124,
    -0.14392874,
    0.02529254,
    0.11812749,
    -0.35331416,
    -0.34620699,
    -0.22996867,
    0.08967996,
    -0.21284145,
    0.36552319,
    0.29441115,
    0.21941371,
    -0.00697371,
    -0.27561355,
    0.39801651,
    0.41923064,
    0.43478313,
    0.80215925,
    -0.24786727,
    -0.03912976,
    -0.25586897,
    0.64286363,
    0.28566852,
    0.16615646,
    0.60975075,
    -0.15454508,
    -0.17162301,
    -0.40664923,
    -0.14827499,
    -0.43017942,
    -0.00688050,
    -0.00625091,
    -0.03612198,
    0.63610703,
    -0.11010699,
    -0.03971139,
    0.24102496,
    0.29353249,
    0.50270790,
    0.16058484,
    -0.22982097,
    -0.32782784,
    -0.12429048,
    -0.00455722,
    -0.04546282,
    -0.13532481,
    0.06300844,
    -0.07114068,
    -0.05724127,
    0.05090607,
    -0.23121120,
    -0.21248035,
    0.41802421,
    -0.45572805,
    0.15298563,
    -0.18013868,
    -0.32166663,
    -0.00000009,
    -0.66581261,
    -0.19607183,
    -0.40865132,
    -0.16692726,
    -0.05116897,
    0.08793754,
    -0.12538117,
    -1.13532102,
    0.14658234,
    0.15331997,
    0.15303960,
    -0.34948054,
    0.11218807,
    -0.20887777,
    0.08851163,
    0.47418857,
    -0.65681350,
    -0.03206315,
    0.23853022,
    0.22500746,
    -0.24814995,
    0.11220372,
    -0.59836179,
    0.22040990,
    0.16952644,
    -0.13515584,
    -0.26813775,
    0.27280301,
    0.24070409,
    -0.18564361,
    0.24090533,
    -0.33419436,
    0.25345904,
    -0.35357827,
    -0.12388758,
    -0.19231881,
    0.19805300,
    -0.58574563,
    0.46908134,
    -0.08140995,
    0.66868246,
    0.10724425,
    0.44659713,
    -0.13416451,
    -0.29545951,
    0.36018708,
    0.16510463,
    -0.21377455,
    0.35949254,
    0.34176272,
    -0.06691284,
    0.16807292,
    -0.06531338,
    -0.00723870,
    -0.51385462,
    -0.30815601,
    0.06599387,
    0.04541940,
    0.20751052,
    0.31855780,
    0.06211564,
    0.29616004,
    0.09456214,
    0.37150308,
];

// CLS_NORM (First sentence)
const GOLDEN_CLS_NORM: &[f32] = &[
    0.06693239,
    -0.00869010,
    -0.01154743,
    0.02623133,
    -0.04019649,
    0.02787703,
    0.01043716,
    -0.00313510,
    -0.02279274,
    0.01881524,
    -0.02146613,
    0.02061770,
    -0.00683857,
    0.01608316,
    -0.03074485,
    -0.03201062,
    -0.04994549,
    0.01484520,
    0.02210484,
    0.02433628,
    -0.01070909,
    -0.02980654,
    0.00622110,
    -0.07469252,
    -0.04230760,
    0.05926776,
    -0.05195768,
    -0.01950857,
    0.03252482,
    -0.08416597,
    -0.05593422,
    0.00099120,
    0.01300143,
    0.02031131,
    0.02083029,
    -0.03875910,
    -0.00363163,
    -0.01263160,
    0.02395764,
    0.03900816,
    0.04287106,
    0.01308280,
    0.02951756,
    -0.03567729,
    0.01710600,
    0.00173122,
    0.06261025,
    -0.10467397,
    0.02374627,
    -0.00977842,
    -0.07104428,
    0.04527846,
    0.04062907,
    0.01528471,
    -0.06962171,
    -0.05024036,
    0.04756690,
    -0.04571599,
    -0.01196978,
    -0.05796431,
    -0.01793182,
    0.02828561,
    0.01056410,
    0.02747246,
    0.02473003,
    -0.06884341,
    -0.06856789,
    -0.00104026,
    -0.02460543,
    0.05741496,
    -0.03215491,
    0.03441468,
    0.01558831,
    0.01964437,
    -0.00400350,
    -0.00887250,
    0.09814846,
    -0.02862266,
    0.05670716,
    0.01092007,
    -0.00831715,
    0.02763855,
    0.02637035,
    0.05804282,
    -0.04996534,
    0.05119353,
    0.02715984,
    0.01722941,
    0.01352154,
    -0.04216412,
    0.07097818,
    0.01664181,
    -0.01235753,
    0.03541125,
    -0.04762233,
    -0.06570311,
    -0.01838773,
    0.02528380,
    -0.00314854,
    0.67333579,
    -0.04072061,
    0.02437036,
    -0.02071479,
    0.07646953,
    -0.01353203,
    -0.00378868,
    0.00330101,
    -0.03985369,
    0.03363343,
    -0.00141360,
    -0.01936320,
    0.00080654,
    -0.02527754,
    0.02504450,
    0.01080172,
    0.05167957,
    0.02297918,
    -0.05928002,
    0.01836606,
    -0.01769497,
    0.02636844,
    -0.09380524,
    0.02466478,
    0.03204957,
    -0.03298425,
    -0.14869830,
    -0.07306913,
    -0.00000000,
    -0.05389118,
    -0.01764147,
    0.01604102,
    -0.02792975,
    0.03763861,
    -0.04581003,
    -0.05027668,
    -0.01059005,
    -0.01582785,
    0.00689395,
    -0.02795931,
    0.01066604,
    -0.00184249,
    -0.04064792,
    -0.03177796,
    -0.03695073,
    0.02192098,
    0.00038120,
    -0.03824829,
    0.00016232,
    0.05553598,
    0.03507750,
    0.01680456,
    0.03705609,
    0.02305885,
    -0.06099298,
    0.04577501,
    -0.02013047,
    0.02644048,
    -0.05331299,
    0.00384279,
    -0.03071906,
    -0.00114610,
    -0.01397352,
    -0.04007654,
    -0.05814185,
    -0.04736509,
    0.01089262,
    -0.01126353,
    0.00674055,
    0.03641746,
    -0.02456235,
    0.04977806,
    0.04134809,
    0.00977588,
    -0.00627498,
    -0.02319396,
    0.02226164,
    0.03292783,
    0.01422943,
    0.05478399,
    0.02781691,
    0.00059594,
    -0.08223466,
    -0.02853579,
    -0.03820506,
    -0.02445138,
    -0.09037235,
    -0.01217021,
    0.08189550,
    0.00613263,
    -0.07657212,
    0.00120799,
    -0.03400683,
    0.00620034,
    -0.05377636,
    0.05154837,
    -0.05493818,
    0.04473411,
    0.04774183,
    -0.04781305,
    0.04437209,
    -0.02011148,
    -0.03503528,
    -0.00856446,
    -0.06878236,
    0.02460039,
    0.02541961,
    -0.01512170,
    -0.01919541,
    0.04400471,
    0.00761243,
    0.01386691,
    0.00656913,
    0.00704103,
    0.00143742,
    -0.00781021,
    0.02314007,
    -0.04501947,
    0.04287410,
    0.01552523,
    0.05147819,
    0.01105095,
    -0.04507475,
    0.00717706,
    0.00000000,
    -0.06380974,
    -0.04675516,
    -0.06313753,
    -0.02524155,
    -0.05532033,
    0.03561936,
    0.05538964,
    0.00114593,
    -0.02168906,
    0.03761197,
    0.04572166,
    0.06702916,
    0.00984904,
    0.01460582,
    0.03250358,
    0.01261829,
    -0.05869788,
    -0.02232238,
    0.00333109,
    -0.05136439,
    -0.03204057,
    0.00954149,
    -0.00661271,
    0.04043529,
    0.00822702,
    0.07458924,
    0.00235943,
    -0.01159165,
    0.00242218,
    -0.06380619,
    -0.00071238,
    -0.05475470,
    -0.00628905,
    0.02457069,
    0.01799764,
    0.04224732,
    -0.05103845,
    -0.07069390,
    -0.04613382,
    -0.01810932,
    0.01224998,
    0.01800414,
    -0.01498710,
    -0.05090954,
    -0.04657779,
    0.00403034,
    -0.04103544,
    0.04746102,
    -0.00407950,
    0.02072115,
    -0.00928236,
    -0.00330458,
    0.00045176,
    0.03183308,
    0.03705503,
    0.03351570,
    -0.00804122,
    0.01379553,
    -0.03061061,
    0.07257733,
    0.00908519,
    -0.00646652,
    0.03802299,
    0.00705738,
    -0.01904294,
    -0.03755798,
    -0.02721029,
    -0.04447792,
    -0.01681637,
    0.00707416,
    0.01732265,
    0.10870963,
    -0.03230841,
    -0.01960009,
    0.02917243,
    0.01521440,
    0.02938895,
    0.02553691,
    -0.06094011,
    -0.01065298,
    0.00432965,
    -0.02886160,
    0.03095647,
    -0.00009532,
    0.02251990,
    0.01305936,
    -0.00883813,
    -0.00386622,
    -0.02178883,
    -0.00387236,
    0.02872237,
    -0.03852340,
    0.04717160,
    -0.01264509,
    -0.06280460,
    -0.00000001,
    -0.08406317,
    -0.00732062,
    -0.04055295,
    -0.01883591,
    -0.00024257,
    0.03664260,
    -0.01929698,
    -0.09330045,
    0.01761180,
    0.05292399,
    0.03946153,
    -0.00850604,
    0.03610617,
    -0.01108110,
    0.00761252,
    0.02785661,
    -0.06700218,
    -0.01325876,
    0.04533584,
    0.01644570,
    -0.01889746,
    0.03176581,
    -0.08235843,
    0.03092980,
    0.01992648,
    0.00938431,
    -0.04085146,
    -0.01849864,
    0.02771669,
    -0.04146230,
    0.03487464,
    -0.05580200,
    0.02378672,
    -0.04279389,
    -0.00542630,
    -0.01685094,
    0.02165408,
    -0.07040037,
    0.04216386,
    0.01696048,
    0.07953232,
    0.00100623,
    0.04078212,
    -0.01623375,
    -0.03857116,
    0.00911670,
    -0.00323067,
    -0.03719939,
    0.02365655,
    0.02667670,
    0.01537085,
    0.04187095,
    -0.00416726,
    0.01843794,
    -0.00609195,
    -0.03897578,
    -0.01801226,
    0.01775444,
    0.05712891,
    0.03743270,
    0.04598374,
    0.02207089,
    -0.02793296,
    0.05452480,
];

// MAX_NORM (First sentence)
const GOLDEN_MAX_NORM: &[f32] = &[
    0.09837011,
    -0.00306254,
    0.00952098,
    0.02462365,
    0.03701117,
    0.02634168,
    0.05718171,
    0.03891246,
    0.03442781,
    0.04908727,
    -0.00109290,
    0.08449707,
    0.04478182,
    0.03656810,
    0.00615033,
    0.00930523,
    -0.02144668,
    0.00844550,
    0.11033467,
    0.05188054,
    0.02392665,
    0.03435535,
    0.04979073,
    -0.02042839,
    -0.00359637,
    0.06950704,
    0.00418199,
    0.01763054,
    0.07947414,
    0.01917033,
    -0.00151720,
    0.03695728,
    0.02349080,
    0.02745846,
    0.04458543,
    -0.02205022,
    0.03707372,
    -0.00718617,
    0.04548125,
    0.08402725,
    0.06620754,
    0.02885619,
    0.01679267,
    -0.00553054,
    0.03680560,
    0.01005035,
    0.07275070,
    -0.02871779,
    0.07596207,
    0.04149548,
    -0.01944159,
    0.04892908,
    0.04333435,
    0.04755823,
    -0.03045131,
    0.00661553,
    0.08430406,
    0.00079725,
    0.02523377,
    0.00563995,
    0.03137689,
    0.02331526,
    0.08053260,
    0.05604228,
    0.03794578,
    0.00350697,
    -0.01644257,
    0.03506923,
    0.04388937,
    0.09918484,
    0.01802714,
    0.02089105,
    0.07085561,
    0.01466195,
    0.00403476,
    0.00494113,
    0.11086648,
    0.01575190,
    0.06341892,
    0.06561307,
    0.02760610,
    0.11776778,
    0.06448582,
    0.03302081,
    0.01799920,
    0.07065553,
    0.05626059,
    0.04491945,
    0.01428388,
    -0.01236863,
    0.05617021,
    0.06185018,
    0.04001745,
    0.07373694,
    0.00550677,
    0.03057479,
    0.00046315,
    0.11217925,
    0.02030881,
    0.38306367,
    0.01121568,
    0.01825667,
    0.05164666,
    0.06870118,
    -0.00769843,
    0.05287772,
    0.03798125,
    0.01966981,
    0.01976370,
    0.00659530,
    0.00220788,
    0.00492474,
    -0.00079111,
    0.07744642,
    0.05463869,
    0.06153505,
    0.04767314,
    -0.00505931,
    0.04481432,
    0.00663479,
    0.05928781,
    -0.03152480,
    0.05376389,
    0.02022344,
    -0.01763811,
    0.01688486,
    -0.01661762,
    0.00000000,
    -0.01690132,
    0.02101958,
    0.00912581,
    -0.01560695,
    0.05943144,
    0.04126274,
    0.01755782,
    0.03536575,
    0.02909042,
    0.03126185,
    0.06551434,
    0.03811370,
    0.06048972,
    0.00602832,
    -0.00847873,
    0.00617242,
    0.04075591,
    0.00137735,
    -0.00007512,
    0.02138811,
    0.06706481,
    0.02251824,
    0.04116938,
    0.02129869,
    0.04399329,
    0.00774061,
    0.04574656,
    -0.00159782,
    0.01504210,
    0.02335390,
    0.04123655,
    0.02001789,
    0.02971072,
    0.05190765,
    0.00810123,
    0.13174042,
    -0.00981034,
    0.07868218,
    0.01257729,
    0.06651092,
    0.04646339,
    0.02278998,
    0.11733496,
    0.08257922,
    0.03017170,
    0.04456337,
    0.01724538,
    0.04062764,
    0.06220737,
    0.05501595,
    0.10627107,
    0.01582516,
    0.08072517,
    -0.02137365,
    -0.00539041,
    0.00132896,
    -0.00383130,
    -0.03163978,
    0.00910186,
    0.05782284,
    0.02409472,
    -0.02885994,
    0.12636937,
    0.02777575,
    0.05606958,
    -0.00837338,
    0.06645218,
    -0.02469867,
    0.06379019,
    0.04462735,
    -0.01704184,
    0.09561370,
    0.01376346,
    0.01686191,
    0.03300152,
    -0.01530870,
    0.01493459,
    0.01446133,
    -0.00860280,
    0.03569137,
    0.08710181,
    0.02950472,
    0.02669533,
    0.06387472,
    0.00400567,
    0.05110229,
    -0.00444326,
    0.11473083,
    -0.01732101,
    0.05453457,
    0.07229231,
    0.05106581,
    0.07761617,
    -0.00767762,
    0.06944180,
    0.00000000,
    -0.00906374,
    0.02811777,
    -0.00152062,
    0.04142903,
    0.00763578,
    0.05135348,
    0.11614637,
    0.08050027,
    0.00876091,
    0.07620919,
    0.06281091,
    0.08640090,
    0.06781108,
    0.04725803,
    0.03402207,
    0.06617530,
    -0.02839950,
    -0.00511543,
    0.03564062,
    0.01221203,
    0.01628369,
    0.08683056,
    0.05639929,
    0.06414206,
    0.02599309,
    0.06485820,
    0.03543267,
    0.02509897,
    0.02166815,
    -0.03340362,
    0.01051430,
    0.04409679,
    0.01783883,
    0.04580116,
    0.05566696,
    0.05460454,
    -0.02903600,
    0.00104919,
    -0.00591592,
    -0.00232272,
    0.01617600,
    0.02107835,
    -0.00538383,
    -0.00299440,
    0.01269983,
    0.02866086,
    0.00297206,
    0.09057909,
    0.08442017,
    0.04776028,
    0.03891433,
    -0.00187999,
    0.07685693,
    0.08914597,
    0.05195353,
    0.12430409,
    0.01283945,
    0.00995530,
    0.00451185,
    0.08508382,
    0.04914050,
    0.05609354,
    0.08194402,
    0.00417540,
    0.02460304,
    -0.01574235,
    0.00390945,
    0.03461078,
    0.03625771,
    0.02916734,
    0.02025526,
    0.10915834,
    0.04553250,
    0.02870710,
    0.06632515,
    0.05762755,
    0.09701914,
    0.03267745,
    0.00112904,
    -0.00606053,
    0.00840032,
    0.02466173,
    0.02583330,
    0.04481007,
    0.06564701,
    0.03022262,
    0.04288942,
    0.01292225,
    0.01202114,
    0.00825698,
    0.07448547,
    -0.01646554,
    0.03650182,
    0.01413766,
    0.00954438,
    -0.00000001,
    -0.03152897,
    -0.00248644,
    0.03598365,
    0.01697166,
    0.03246862,
    0.02729274,
    0.05843400,
    -0.04253734,
    0.03351353,
    0.05894968,
    0.05959058,
    -0.00483912,
    0.03420400,
    0.02509531,
    0.04728098,
    0.07651489,
    -0.02803408,
    0.01013716,
    0.05046828,
    0.06422973,
    0.00223395,
    0.04340328,
    -0.02749115,
    0.08301448,
    0.05178632,
    0.00533878,
    -0.00273461,
    0.08229357,
    0.03526015,
    0.02843988,
    0.03506461,
    0.03613131,
    0.07170164,
    0.00467210,
    0.01712538,
    0.00548358,
    0.03891252,
    -0.02478359,
    0.05595644,
    0.07453853,
    0.07991514,
    0.04224993,
    0.05700653,
    0.04592279,
    0.01663516,
    0.05850737,
    0.11352082,
    0.04216529,
    0.05490277,
    0.05336460,
    0.03583509,
    0.06819917,
    0.00367181,
    0.03837742,
    -0.00346574,
    -0.00511839,
    0.05318320,
    0.04652175,
    0.03801406,
    0.03607120,
    0.05076317,
    0.07279571,
    0.07668959,
    0.05729823,
];

// LAST_NORM (First sentence)
const GOLDEN_LAST_NORM: &[f32] = &[
    0.14747009,
    -0.03314227,
    -0.01530659,
    0.05962573,
    -0.06124690,
    0.06616312,
    0.04025749,
    0.06413589,
    0.00563476,
    0.01687099,
    -0.03195376,
    0.02965241,
    0.01127097,
    0.02643294,
    -0.01772382,
    -0.04149045,
    -0.10767169,
    0.01779018,
    0.01576631,
    0.02409775,
    0.00458001,
    -0.01193404,
    0.00851563,
    -0.05833572,
    -0.02693945,
    0.06744560,
    -0.03001547,
    -0.08359341,
    0.04218515,
    0.01426363,
    -0.03623448,
    -0.02603124,
    -0.00467598,
    0.06896817,
    0.02637578,
    -0.10639491,
    -0.02292276,
    -0.07116342,
    0.02291227,
    0.02604589,
    0.03783262,
    0.00824082,
    -0.01148835,
    -0.07575181,
    0.02109785,
    0.01275027,
    0.10082504,
    -0.08106128,
    0.03857846,
    -0.03388039,
    -0.12220396,
    0.06783839,
    0.02896432,
    0.05394496,
    -0.10362151,
    -0.00898913,
    0.07180794,
    -0.06143194,
    -0.02162139,
    -0.09088002,
    -0.02352310,
    0.05856157,
    0.07090794,
    0.14076291,
    0.04175773,
    -0.07705040,
    -0.04537885,
    -0.00580547,
    -0.01632885,
    0.04102684,
    0.01917416,
    0.02484339,
    -0.01604678,
    0.00382385,
    -0.01723134,
    -0.05199569,
    0.15611222,
    0.01368482,
    0.08767206,
    0.02724864,
    -0.00386560,
    0.07332282,
    0.05591607,
    0.04897021,
    -0.01837078,
    0.08417938,
    0.03515799,
    0.06656295,
    -0.00727435,
    -0.04460987,
    0.07226385,
    0.01088924,
    -0.05560492,
    0.05478516,
    0.01383150,
    -0.05150193,
    -0.01598402,
    0.03207352,
    0.00272645,
    -0.15552293,
    -0.02994757,
    0.01003592,
    0.01106073,
    0.11705951,
    -0.04860355,
    0.02670944,
    0.04143390,
    -0.00143419,
    -0.00248907,
    -0.01029501,
    -0.02764543,
    -0.01188638,
    -0.07053418,
    0.03987682,
    0.01579899,
    0.05360527,
    -0.01841241,
    -0.09852695,
    0.00724342,
    -0.07368823,
    0.05146309,
    -0.10155736,
    0.01627876,
    0.03928214,
    -0.05945852,
    0.00028354,
    -0.04173894,
    -0.00000000,
    -0.05697645,
    -0.03722896,
    -0.02179010,
    -0.03998380,
    0.05830781,
    -0.03777124,
    -0.00230722,
    0.01004262,
    -0.07131369,
    0.05153146,
    -0.00276623,
    0.04580801,
    0.00225086,
    0.00529477,
    -0.05824405,
    -0.09238730,
    0.00707502,
    -0.03387428,
    -0.00018869,
    0.00992159,
    0.08985504,
    0.02383638,
    0.02186123,
    0.01056740,
    -0.02971664,
    -0.07584455,
    0.04636941,
    -0.03526906,
    -0.00423021,
    -0.04986283,
    -0.01455211,
    -0.06497429,
    0.05824188,
    0.01440290,
    -0.05448883,
    -0.10526717,
    -0.02863199,
    0.00297731,
    -0.02940761,
    -0.00078013,
    0.05141343,
    0.00757448,
    0.03777216,
    0.06098082,
    -0.00485795,
    0.00696664,
    -0.04567250,
    0.04160122,
    0.02698793,
    0.03378211,
    0.07089177,
    -0.01027116,
    0.00298463,
    -0.08324220,
    -0.05383649,
    -0.05826425,
    -0.04642796,
    -0.11623400,
    -0.01458611,
    0.08015575,
    0.00274943,
    -0.11272428,
    -0.00592965,
    -0.00144113,
    0.05598577,
    -0.07042431,
    0.06167117,
    -0.07885715,
    0.08333007,
    0.05546731,
    -0.07004382,
    0.06558650,
    -0.01452727,
    -0.04385592,
    -0.00879984,
    -0.05031187,
    0.03211452,
    0.01354794,
    -0.03790191,
    0.01980023,
    0.01899047,
    0.03002670,
    0.05838056,
    0.02882673,
    -0.04796655,
    0.02375714,
    -0.03778185,
    0.02724945,
    -0.05898964,
    0.06004224,
    0.02641459,
    0.04632388,
    -0.00264340,
    -0.03193414,
    0.04941887,
    0.00000000,
    -0.04260188,
    -0.02498008,
    -0.05080451,
    -0.02443717,
    -0.09265587,
    0.03570063,
    0.05366446,
    0.05171237,
    -0.05023268,
    -0.01408381,
    0.02646669,
    0.11952987,
    0.10322193,
    0.03189603,
    -0.03006192,
    0.00478955,
    -0.09063034,
    -0.03297687,
    0.05783359,
    -0.00297669,
    -0.00725495,
    -0.00461353,
    -0.05794214,
    0.04233612,
    0.01151881,
    0.02981707,
    0.02591335,
    0.02640058,
    -0.00680901,
    -0.13573170,
    0.00289589,
    -0.04124694,
    0.03328548,
    0.01821463,
    0.04261126,
    0.03003150,
    -0.07641449,
    -0.10141108,
    -0.04533607,
    -0.01024167,
    0.02259939,
    0.03583062,
    -0.01352270,
    -0.00752113,
    -0.01216775,
    0.00505627,
    -0.01059190,
    0.02357010,
    0.05184512,
    0.00767909,
    0.01714950,
    -0.05037284,
    0.05017406,
    0.04588548,
    0.08785553,
    0.10453784,
    -0.03856434,
    0.00109939,
    -0.05784157,
    0.08802236,
    0.04002529,
    0.01446601,
    0.08363744,
    0.00176175,
    -0.03512633,
    -0.06762177,
    -0.00613677,
    -0.07271040,
    0.00825373,
    -0.02662484,
    0.03084341,
    0.08880166,
    -0.01603566,
    -0.04583617,
    0.01196892,
    0.04365319,
    0.02921891,
    0.00712136,
    -0.03257574,
    -0.06653321,
    -0.02255305,
    -0.00490703,
    -0.04358528,
    -0.01674723,
    0.01574270,
    -0.05661843,
    0.02171633,
    0.00084992,
    -0.06668918,
    -0.01494801,
    0.04474360,
    -0.06909339,
    0.02689555,
    -0.02614812,
    -0.04726372,
    -0.00000002,
    -0.09850658,
    -0.05274425,
    -0.06555797,
    -0.03689395,
    0.00122718,
    0.03319827,
    -0.00695131,
    -0.14234991,
    0.00967787,
    0.06792194,
    0.01756960,
    -0.02179267,
    0.01424825,
    0.00285498,
    0.01241105,
    0.08979641,
    -0.11492322,
    0.02207788,
    0.05448015,
    0.04397616,
    -0.02885262,
    -0.04302870,
    -0.06905028,
    -0.00534389,
    -0.01351409,
    -0.00071762,
    -0.06156271,
    0.06018299,
    0.00587303,
    -0.04119278,
    0.04281577,
    -0.04570000,
    0.05085890,
    -0.06184841,
    -0.00255892,
    -0.03988514,
    0.04176776,
    -0.10143266,
    0.06029087,
    0.02034800,
    0.10030046,
    0.03735899,
    0.04049229,
    -0.03891588,
    -0.01273992,
    0.02693823,
    0.00418451,
    -0.08045395,
    0.04563692,
    0.06610755,
    -0.01389197,
    0.05457141,
    0.00194412,
    -0.01977878,
    -0.05629338,
    -0.01623117,
    0.00634214,
    0.00610751,
    0.02853290,
    0.05802215,
    0.01933980,
    0.06438656,
    0.01496098,
    0.10192965,
];

